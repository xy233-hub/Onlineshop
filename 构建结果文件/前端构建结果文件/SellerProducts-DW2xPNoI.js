import{_ as m,c as l,b as t,a as c,w as k,d as i,v as p,F as _,g as w,t as h,o as d}from"./index-5YFhHKL4.js";const y={name:"SellerProducts",data(){return{products:[],showAdd:!1,newProduct:{product_name:"",product_desc:"",image_url:"",price:null},error:""}},mounted(){this.fetchProducts()},methods:{async fetchProducts(){this.error="";const s=localStorage.getItem("seller_token"),n=await(await fetch("/api/seller/products",{headers:{Authorization:`Bearer ${s}`}})).json();n.code===200?this.products=n.data:this.error=n.message},async addProduct(){this.error="";const s=localStorage.getItem("seller_token"),n=await(await fetch("/api/seller/product",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(this.newProduct)})).json();n.code===200?(this.showAdd=!1,this.newProduct={product_name:"",product_desc:"",image_url:"",price:null},this.fetchProducts()):this.error=n.message},async freeze(s){const e=localStorage.getItem("seller_token");await fetch("/api/seller/product/freeze",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({product_id:s})}),this.fetchProducts()},async unfreeze(s){const e=localStorage.getItem("seller_token"),u=await(await fetch("/api/seller/product/unfreeze",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({product_id:s})})).json();u.code===200?(this.fetchProducts(),this.error=""):u.code===400&&u.message==="已有商品在售，不能解冻"?this.error=u.message:this.error=u.message},async markSold(s){const e=localStorage.getItem("seller_token");await fetch("/api/seller/product/mark-sold",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({product_id:s})}),this.fetchProducts()}}},g={class:"seller-products-wrapper"},P={class:"seller-products-card"},b={class:"modal-card"},v={class:"modal-actions"},C=["onClick"],S=["onClick"],z=["onClick"],A={key:1,class:"error"};function T(s,e,n,u,r,a){return d(),l("div",g,[t("div",P,[e[11]||(e[11]=t("h2",null,"商品管理",-1)),t("button",{onClick:e[0]||(e[0]=o=>r.showAdd=!0),class:"add-btn"},"发布新商品"),r.showAdd?(d(),l("div",{key:0,class:"modal-mask",onClick:e[7]||(e[7]=k(o=>r.showAdd=!1,["self"]))},[t("div",b,[e[9]||(e[9]=t("h3",null,"发布新商品",-1)),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.newProduct.product_name=o),placeholder:"商品名称"},null,512),[[p,r.newProduct.product_name]]),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.newProduct.product_desc=o),placeholder:"商品描述"},null,512),[[p,r.newProduct.product_desc]]),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.newProduct.image_url=o),placeholder:"图片链接"},null,512),[[p,r.newProduct.image_url]]),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.newProduct.price=o),placeholder:"价格",type:"number"},null,512),[[p,r.newProduct.price,void 0,{number:!0}]]),t("div",v,[t("button",{class:"primary",onClick:e[5]||(e[5]=(...o)=>a.addProduct&&a.addProduct(...o))},"提交"),t("button",{class:"cancel",onClick:e[6]||(e[6]=o=>r.showAdd=!1)},"取消")])])])):c("",!0),t("table",null,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"名称"),t("th",null,"价格"),t("th",null,"状态"),t("th",null,"操作")])],-1)),t("tbody",null,[(d(!0),l(_,null,w(r.products,o=>(d(),l("tr",{key:o.product_id},[t("td",null,h(o.product_name),1),t("td",null,h(o.price),1),t("td",null,h(o.product_status),1),t("td",null,[o.product_status==="online"?(d(),l("button",{key:0,onClick:f=>a.freeze(o.product_id)},"冻结",8,C)):c("",!0),o.product_status==="frozen"?(d(),l("button",{key:1,onClick:f=>a.unfreeze(o.product_id)},"解冻",8,S)):c("",!0),o.product_status!=="sold"?(d(),l("button",{key:2,onClick:f=>a.markSold(o.product_id)},"标记售出",8,z)):c("",!0)])]))),128))])]),r.error?(d(),l("div",A,h(r.error),1)):c("",!0),t("button",{class:"back-btn",onClick:e[8]||(e[8]=o=>s.$router.back())},"返回")])])}const j=m(y,[["render",T],["__scopeId","data-v-ff14aa6f"]]);export{j as default};
